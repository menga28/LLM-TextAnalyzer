<source>
  @type tail
  path ../datasets/content.xml
  pos_file /fluentd/log/content.pos
  tag dataset.content
  
  <parse>
    @type xml
    xpath //*
    time_xpath "//*[1]"  # Indica un percorso XML generico
    time_format %Y-%m-%dT%H:%M:%S%z
  </parse>
</source>

<source>
  @type tail
  path ../datasets/query.xml
  pos_file /fluentd/log/query.pos
  tag dataset.query
  
  <parse>
    @type xml
    xpath //question/question
    time_xpath "//*[1]"
    time_format %Y-%m-%dT%H:%M:%S%z
  </parse>
</source>

<source>
  @type tail
  path ../datasets/result.xml
  pos_file /fluentd/log/result.pos
  tag dataset.result
  
  <parse>
    @type xml
    xpath //results/result
    time_xpath "//*[1]"
    time_format %Y-%m-%dT%H:%M:%S%z
  </parse>
</source>

<match dataset.content>
  @type http
  endpoint http://couchdb:5984/content
  http_method post
  serializer json
  <buffer>
    @type memory
    flush_interval 5s
  </buffer>
  headers {"Authorization":"Basic base64encoded_username:password"}
</match>

<match dataset.query>
  @type http
  endpoint http://couchdb:5984/query
  http_method post
  serializer json
  <buffer>
    @type memory
    flush_interval 5s
  </buffer>
  headers {"Authorization":"Basic base64encoded_username:password"}
</match>

<match dataset.result>
  @type http
  endpoint http://couchdb:5984/result
  http_method post
  serializer json
  <buffer>
    @type memory
    flush_interval 5s
  </buffer>
  headers {"Authorization":"Basic base64encoded_username:password"}
</match>
